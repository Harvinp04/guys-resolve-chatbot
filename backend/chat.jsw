import { fetch } from 'wix-fetch';
import { getSecret } from 'wix-secrets-backend';

export async function getChatResponse(message) {
    try {
        const apiKey = await getSecret('GEMINI_API_KEY');
        console.log("Using API Key:", apiKey);
        const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=' + apiKey, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                contents: [{ parts: [{ text: message + " If the user seems to be in crisis, include: 'If you’re in crisis, call 911 or a hotline.'" }] }]
            })
        });
        console.log("API Response Status:", response.status);
        const data = await response.json();
        console.log("API Response Data:", data);
        return data.candidates?.[0].content.parts[0].text || "Sorry, I couldn’t process your request.";
    } catch (error) {
        console.error("Gemini API Error:", error);
        return "Oops, something went wrong!";
    }
}